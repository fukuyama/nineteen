{"version":3,"sources":["nz/ai/Chaser.coffee","nz/ai/Chaser.js"],"names":["_g","nz","ref","ref1","window","global","ai","Chaser","this","defaultAI","Default","ruleAI","Rule","rule","cond","param","setFriendsAndTargets","setNearTarget","p","calcSlidePosition","target","character","length","checkMovePosition","distance","setup","setAttackCommand","setMoveCommand","mapx","mapy","prototype","setupBattlePosition","o","setupAction","add","a","d","g","m","r","s","t","tm","geom","Vector2","setObject","utils","mapxy2screenxy","sub","toAngle","setRadian","screenxy2mapxy","system","addAI","call"],"mappings":"CAAA,WAAA,GAAAA,GAAAC,EAAAC,EAAAC,CAMAH,GAAA,mBAAAI,SAAA,OAAAA,OAAKA,OAASC,OACdJ,EAAKD,EAAGC,GAAH,OAAAC,EAAAF,EAAAC,IAAAC,KACLF,EAAK,OAELC,EAAGK,GAAH,OAAAH,EAAAF,EAAAK,IAAAH,KAEMF,EAAGK,GAAGC,OAAA,WAgCG,QAAAA,KACXC,KAACC,UAAgB,GAAAR,GAAGK,GAAGI,QACvBF,KAACG,OAAgB,GAAAV,GAAGK,GAAGM,KAAKJ,MAE5BA,KAACK,MACCC,KAAM,SAACC,GAIL,MAFAA,GAAMC,uBACND,EAAME,iBACC,KACXT,KAACK,MACCC,KAAM,SAACC,GACL,GAAAG,EAIA,OAJAA,GAAIV,KAACW,mBACHC,OAAQL,EAAMK,OACdC,UAAWN,EAAMM,UACjBC,OAAQ,IACPP,EAAMQ,kBAAkBL,IAAOH,EAAMS,UAAY,GAC3C,GACF,GACTC,MAAO,SAACV,GACN,GAAAG,EAMA,OANAA,GAAIV,KAACW,mBACHC,OAAQL,EAAMK,OACdC,UAAWN,EAAMM,UACjBC,OAAQ,IACVP,EAAMW,mBACNX,EAAMY,gBAAeP,OAAOF,KACrB,KACXV,KAACK,MACCC,KAAM,SAACC,GACL,MAAOA,GAAMS,UAAY,GAC3BC,MAAO,SAACV,GAEN,MADAA,GAAMY,kBACC,KACXnB,KAACK,MACCC,KAAM,SAACC,GAEL,OAAO,GACTU,MAAO,SAACV,GAQN,MANAA,GAAMY,gBACJP,QACEQ,KAAM,EACNC,KAAM,MAGH,KCuBX,MDlGFtB,GAAAuB,UAAAC,oBAAqB,SAACC,GCKlB,MDLwBxB,MAACC,UAAUsB,oBAAoBC,IAA3DzB,EAAAuB,UACAG,YAAa,SAACD,GCQV,MDRgBxB,MAACG,OAAOsB,YAAYD,IADxCzB,EAAAuB,UAEAjB,KAAM,SAACmB,GCWH,MDXSxB,MAACG,OAAOuB,IAAIF,IAFzBzB,EAAAuB,UAIAX,kBAAmB,SAACJ,GAClB,GAAAoB,GAAAd,EAAAe,EAAAC,EAAAf,EAAAgB,EAAAC,EAAAC,EAAAC,EAAArB,CAmBA,OAlBEA,GAAAL,EAAAK,OACAC,EAAAN,EAAAM,UACAC,EAAAP,EAAAO,OAEFgB,EAAa,GAAThB,EAEJmB,EAAIC,GAAGC,KAAKC,UAAUC,UAAU5C,EAAG6C,MAAMC,eAAe3B,IAExDoB,EAAIE,GAAGC,KAAKC,UAAUC,UAAU5C,EAAG6C,MAAMC,eAAe1B,IAExDe,EAAII,EAAEhB,SAASiB,GAEfF,EAAIC,EAAEQ,IAAIP,GAAGQ,UAEbV,GAAKD,EAAIF,EAETC,EAAIK,GAAGC,KAAKC,UAAUM,UAAUX,EAAEH,GAAGF,IAAIO,GACzCN,EAAIlC,EAAG6C,MAAMK,eAAed,IC2ErB9B,KDrBXN,EAAGmD,OAAOC,MAAM,SAAc,GAAApD,GAAGK,GAAGC,UC2BjC+C,KAAK9C","file":"nz/ai/Chaser.js","sourcesContent":["###*\n* @file Chaser.coffee\n* チェイサーAI\n###\n\n# node.js と ブラウザでの this.nz を同じインスタンスにする\n_g = window ? global\nnz = _g.nz = _g.nz ? {}\n_g = undefined\n\nnz.ai = nz.ai ? {}\n\nclass nz.ai.Chaser\n\n  setupBattlePosition: (o) -> @defaultAI.setupBattlePosition o\n  setupAction: (o) -> @ruleAI.setupAction o\n  rule: (o) -> @ruleAI.add o\n\n  calcSlidePosition: (param) ->\n    {\n      target\n      character\n      length\n    } = param\n    m = length * 32\n    # ターゲット\n    t = tm.geom.Vector2().setObject nz.utils.mapxy2screenxy target\n    # 自分の位置\n    s = tm.geom.Vector2().setObject nz.utils.mapxy2screenxy character\n    # ターゲットまでの距離\n    d = s.distance t\n    # ターゲットからの方向\n    r = s.sub(t).toAngle()\n    # 移動後の方向\n    r += m / d\n    # 目的値\n    g = tm.geom.Vector2().setRadian(r,d).add(t)\n    a = nz.utils.screenxy2mapxy g\n    return a\n\n  ###* 初期化\n  * @classdesc サンプルAIクラス\n  * @constructor nz.ai.Chaser\n  ###\n  constructor: ->\n    @defaultAI = new nz.ai.Default()\n    @ruleAI    = new nz.ai.Rule(@)\n\n    @rule\n      cond: (param) ->\n        # 敵味方分け\n        param.setFriendsAndTargets()\n        param.setNearTarget()\n        return false\n    @rule\n      cond: (param) ->\n        p = @calcSlidePosition\n          target: param.target\n          character: param.character\n          length: 2\n        if param.checkMovePosition(p) and param.distance <= 4\n          return true\n        return false\n      setup: (param) ->\n        p = @calcSlidePosition\n          target: param.target\n          character: param.character\n          length: 2\n        param.setAttackCommand()\n        param.setMoveCommand(target:p)\n        return true\n    @rule\n      cond: (param) ->\n        return param.distance >= 6\n      setup: (param) ->\n        param.setMoveCommand()\n        return true\n    @rule\n      cond: (param) ->\n        # どれでもない時\n        return true\n      setup: (param) ->\n        # 中央へ\n        param.setMoveCommand(\n          target: {\n            mapx: 6\n            mapy: 6\n          }\n        )\n        return true\n\nnz.system.addAI 'Chaser', new nz.ai.Chaser()\n",null],"sourceRoot":"/source/"}