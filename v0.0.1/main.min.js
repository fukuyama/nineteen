(function(){var t,e,i;t="undefined"!=typeof window&&null!==window?window:global,e=t.nz=null!=(i=t.nz)?i:{},t=void 0,e.System=function(){function t(){this.ai={}}return t.prototype.title="Nineteen",t.prototype.direction_num={UP:0,UP_RIGHT:1,DOWN_RIGHT:2,DOWN:3,DOWN_LEFT:4,UP_LEFT:5},t.prototype.character={directions:[{name:"up",rotation:-90,index:0,rotateIndex:[0,1,2,3,-2,-1]},{name:"up_right",rotation:-30,index:1,rotateIndex:[-1,0,1,2,3,-2]},{name:"down_right",rotation:30,index:2,rotateIndex:[-2,-1,0,1,2,3]},{name:"down",rotation:90,index:3,rotateIndex:[3,-2,-1,0,1,2]},{name:"down_left",rotation:150,index:4,rotateIndex:[2,3,-2,-1,0,1]},{name:"up_left",rotation:-150,index:5,rotateIndex:[1,2,3,-2,-1,0]},{name:"default",rotation:90,index:6,rotateIndex:[0,1,2,3,-2,-1]}],action_cost:{move:1,rotate:1,attack:2,shot:2},stamina_cost:{move:1,rotate:1,attack:4,shot:2}},t.prototype.map={chip:{width:32,height:32}},t.prototype.screen={width:640,height:480},t.prototype.dialog={strokeStyle:"rgba(255,255,255,1.0)",fillStyle:"rgba(128,128,128,1.0)"},t.prototype.assets={chipdata:"data/chipdata.json",map_object:"img/map_object.png",map_chip:"img/map_chip.png",character_001:{type:"tmss",src:"data/character_001.json"},character_test:{type:"tmss",src:"data/character_test.json"}},t.prototype.messages={battle:{position:{setiing:"{name} の開始位置を選択してください。"}}},t.prototype.addAI=function(t,e){return this.ai[t]=e},t.prototype.start=function(){this.app.replaceScene(e.SceneTitleMenu())},t.prototype.restart=function(){this.start()},t}(),e.system=new e.System}).call(this),function(){var t,e,i,n,a,s;n="undefined"!=typeof window&&null!==window?window:global,a=n.nz=null!=(s=n.nz)?s:{},n=void 0,i=a.system.map.chip.width,e=a.system.map.chip.height,t=a.system.character.directions,a.Utils=function(){function n(){}return n.prototype.marge=function(t,e){var i,n;for(i in e)n=e[i],"object"==typeof n?n instanceof Array?t[i]=[].concat(n):(null==t[i]&&(t[i]={}),this.marge(t[i],n)):t[i]=n;return t},n.prototype.searchRoute=function(t,e,i,n,a){var s,r,o,h,c,p;for(null==a&&(a={}),null==a.grid&&(a.grid=[]),null==a.graph&&(a.graph={cost:e.ap}),null==a.closest&&(a.closest=!0),o=0,h=n.length;h>o;o++)s=n[o],!s.isAlive()||e.mapx===s.mapx&&e.mapy===s.mapy||a.grid.push({mapx:s.mapx,mapy:s.mapy,options:{isWall:!0}});return r=e.direction,c=e.mapx,p=e.mapy,t.searchRoute(r,c,p,i.mapx,i.mapy,a)},n.prototype.mapxy2screenxy=function(t){var n;return 2===arguments.length&&(t={mapx:arguments[0],mapy:arguments[1]}),n={x:t.mapx*i+.5*i,y:t.mapy*e+.5*e},t.mapx%2===0&&(n.y+=.5*e),n},n.prototype.screenxy2mapxy=function(t){var n,a;return 2===arguments.length&&(t={x:arguments[0],y:arguments[1]}),n=Math.floor(t.x/i),a=Math.floor(n%2===0?(t.y-.5*e)/e:t.y/e),0>n&&(n=0),0>a&&(a=0),{mapx:n,mapy:a}},n.prototype.relativeRotation=function(t,e,i){var n;return n=0,n=null!=i?Math.radToDeg(Math.atan2(i.y-e.y,i.x-e.x)):e%360,n-=t,n>180?n-=360:-180>n&&(n+=360),n},n.prototype.lineRoute=function(t,e){var i,n,s,r,o,h,c,p,l,u,m,d,f,g,y,v;if(d=[{mapx:t.mapx,mapy:t.mapy}],s=e.mapx-t.mapx,r=e.mapy-t.mapy,o=0>s?-1:1,h=0>r?-1:1,i=Math.abs(s),n=Math.abs(r),n>i)for(f=0===n?o:s/n,g=0>r?-1:1,v=c=1,u=n;u>=1?u>=c:c>=u;v=u>=1?++c:--c){for(l={mapx:t.mapx+f*v,mapy:t.mapy+g*v},l.mapx=Math.round(l.mapx);a.Graph.distance(d[d.length-1],l)>1;)d.push({mapx:l.mapx-o,mapy:l.mapy});d.push(l)}else for(f=0>s?-1:1,g=0===i?h:r/i,y=p=1,m=i;m>=1?m>=p:p>=m;y=m>=1?++p:--p){for(l={mapx:t.mapx+f*y,mapy:t.mapy+g*y},l.mapx%2===0&&(l.mapy-=.5),l.mapy=Math.round(l.mapy);a.Graph.distance(d[d.length-1],l)>1;)d.push({mapx:l.mapx,mapy:l.mapy-h});d.push(l)}return d},n.prototype.checkDirectionRange=function(e){var i,n,s,r,o,h,c,p,l,u,m,d,f;return u=e.rotation,m=e.source,f=e.target,n=e.callback,p=e.range,d=p.start,s=p.end,i=p.anticlockwise,null==u&&(u=t[m.direction].rotation),r=a.utils.relativeRotation(u,m,f),o=i?s:d,h=i?d:s,l=!1,l=h>o?r>=o&&h>=r:r>=o||h>=r,null!=n&&(l?c=r:(o>r&&(c=o),r>h&&(c=h)),n(l,c)),l},n}(),a.utils=new a.Utils}.call(this),function(){var t,e,i,n,a;i="undefined"!=typeof window&&null!==window?window:global,n=i.nz=null!=(a=i.nz)?a:{},i=void 0,e=[[[[0,-1,0],[0,0,5],[0,0,1],[0,1,0]],[[1,0,1],[0,0,0],[0,0,2],[-1,1,1]],[[1,1,2],[0,0,1],[0,0,3],[-1,0,2]],[[0,1,3],[0,0,2],[0,0,4],[0,-1,3]],[[-1,1,4],[0,0,3],[0,0,5],[1,0,4]],[[-1,0,5],[0,0,4],[0,0,0],[1,1,5]]],[[[0,-1,0],[0,0,5],[0,0,1],[0,1,0]],[[1,-1,1],[0,0,0],[0,0,2],[-1,0,1]],[[1,0,2],[0,0,1],[0,0,3],[-1,-1,2]],[[0,1,3],[0,0,2],[0,0,4],[0,-1,3]],[[-1,0,4],[0,0,3],[0,0,5],[1,-1,4]],[[-1,-1,5],[0,0,4],[0,0,0],[1,0,5]]]],n.Graph=function(){function t(t){var e,i,a,s,r,o,h,c,p,l,u,m;for(null==t&&(t={}),o=t.mapdata,e=t.chipdata,this.nodes=[],this.grid=[],u=a=0,c=o.width;c>=0?c>a:a>c;u=c>=0?++a:--a)this.grid[u]=[];for(m=s=0,p=o.height;p>=0?p>s:s>p;m=p>=0?++s:--s)for(u=r=0,l=o.width;l>=0?l>r:r>l;u=l>=0?++r:--r)(m!==o.height-1||u%2!==0)&&(i=o.data[m][u],h=new n.GridNode(u,m,e[i]),this.grid[u][m]=h,this.nodes.push(h));this.clear()}return t.prototype.clear=function(){var t,e,i,n;for(this.cleanWrap(),n=this.nodes,t=0,e=n.length;e>t;t++)i=n[t],i.clean()},t.prototype.cleanDirty=function(){},t.prototype.markDirty=function(t){},t.prototype.cleanWrap=function(){this.wrapNodes={}},t.prototype.getWrap=function(t,e,i){var a;return a=t+"-"+e,null!=this.wrapNodes[a]?this.wrapNodes[a]:(null==i?null==this.wrapNodes[a]&&(this.wrapNodes[a]=new n.GridNodeWrap(this.grid[t][e]),astar.cleanNode(this.wrapNodes[a])):(a=t+"-"+e+"-"+i,null==this.wrapNodes[a]&&(this.wrapNodes[a]=new n.GridNodeWrap(this.grid[t][e],i),astar.cleanNode(this.wrapNodes[a]))),this.wrapNodes[a])},t.prototype.neighbors=function(t){var i,n,a,s,r,o,h,c,p;for(s=e[t.mapx%2][t.direction],h=[],n=0,a=s.length;a>n;n++)r=s[n],c=r[0],p=r[1],i=r[2],null!=(null!=(o=this.grid[c+t.mapx])?o[p+t.mapy]:void 0)&&h.push(this.getWrap(c+t.mapx,p+t.mapy,i));return h},t.prototype.toString=function(){var t,e,i,n,a,s,r,o,h;for(t=[],o=this.grid,e=0,n=o.length;n>e;e++){for(r=o[e],h=[],i=0,a=r.length;a>i;i++)s=r[i],h.push(s.weight);t.push(h.join(" "))}return t.join("\n")},t.prototype.searchRoute=function(t,e,i,a,s,r){var o,h,c,p,l,u,m,d,f,g,y,v,_,S,x;if(null==r&&(r={}),_=[],S=this.getWrap(e,i,t),o=this.getWrap(a,s),!o.isWall()||r.closest){for(null==r.closest&&(r.closest=!1),null==r.heuristic&&(r.heuristic=n.Graph.heuristic),null==r.grid&&(r.grid=[]),g=r.grid,c=0,u=g.length;u>c;c++)h=g[c],this.grid[h.mapx][h.mapy].options=h.options;for(null!=r.graph&&(this.options=r.graph),v=astar.search(this,S,o,r),f=t,p=0,m=v.length;m>p;p++)x=v[p],_.push({mapx:x.mapx,mapy:x.mapy,cost:x.g,back:x.back,direction:x.direction<0?f:x.direction}),f=x.direction;for(y=r.grid,l=0,d=y.length;d>l;l++)h=y[l],this.grid[h.mapx][h.mapy].options=void 0;this.options=void 0}return this.cleanWrap(),_},t}(),n.Graph.heuristic=function(t,e){var i,a,s,r,o;return r=Math.abs(t.mapx-e.mapx),o=Math.abs(t.mapy-e.mapy),s=Math.ceil(r/2),i=t.node.calcDirectionTo(e),a=n.Graph.directionCost(t.direction,i),o===s?o=0:s>o?0!==o&&(o=1,1===a&&(a=0)):o-=s,r+o+a},n.Graph.direction=function(t,e){var i,a,s;return a=n.Graph.distance(t,e),s=Math.floor(a/2),i=0,e.mapx-s<=t.mapx&&t.mapx<=e.mapx+s?(t.mapy>e.mapy&&(i=0),t.mapy<e.mapy&&(i=3)):t.mapx>e.mapx?t.mapy===e.mapy?i=t.mapx%2===0?5:4:t.mapy>e.mapy?i=5:t.mapy<e.mapy&&(i=4):t.mapx<e.mapx&&(t.mapy===e.mapy?i=t.mapx%2===0?1:2:t.mapy>e.mapy?i=1:t.mapy<e.mapy&&(i=2)),i},n.Graph.distance=function(t,e){var i,n,a;return n=Math.abs(t.mapx-e.mapx),a=Math.abs(t.mapy-e.mapy),i=Math.ceil(n/2),i>a?n:(n%2===1&&(t.mapx%2===1?t.mapy<=e.mapy&&(a+=1):t.mapy>=e.mapy&&(a+=1)),n+a-i)},n.Graph.directionCost=function(t,e){return Math.abs(3-Math.abs((e-t-3)%6))},t=[[[0,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]],[[0,-1],[1,-1],[1,0],[0,1],[-1,0],[-1,-1]]],n.Graph.frontPosition=function(e){var i,n;return i=(e.direction+6)%6,n=e.mapx%2,{mapx:e.mapx+t[n][i][0],mapy:e.mapy+t[n][i][1],direction:i}},n.Graph.backPosition=function(t){var e;return e=n.Graph.frontPosition({mapx:t.mapx,mapy:t.mapy,direction:t.direction+3}),e.direction=t.direction,e},n.Graph.hexLine=function(t){var e,i,n,a;for(a=[],i=e=0,n=t.distance;n>=0?n>e:e>n;i=n>=0?++e:--e)a.push(t=this.frontPosition(t));return a},n.Graph.frontArea=function(t){var e,i,n,a,s,r;for(s=[],r=this.hexLine(t),i=n=0,a=r.length;a>n;i=++n)e=r[i],s.push(e),e.direction+=2,e.distance=i+1,Array.prototype.push.apply(s,this.hexLine(e));return s}}.call(this),function(){var t,e,i;t="undefined"!=typeof window&&null!==window?window:global,e=t.nz=null!=(i=t.nz)?i:{},t=void 0,e.GridNodeWrap=function(){function t(t,e){null==e&&(e=-1),this.node=t,this.direction=e,this.back=!1}return t.prototype.clean=function(){return this.node.clean()},t.prototype.getCost=function(t){var i;return i=this.node.weight,this.mapx===t.mapx&&this.mapy===t.mapy?i=1:e.Graph.direction(this,t)===t.direction&&(i+=1,this.back=!0),i},t.prototype.isWall=function(){return this.node.isWall()},t}(),Object.defineProperty(e.GridNodeWrap.prototype,"mapx",{get:function(){return this.node.mapx},enumerable:!0}),Object.defineProperty(e.GridNodeWrap.prototype,"mapy",{get:function(){return this.node.mapy},enumerable:!0}),e.GridNode=function(){function t(t,e,i){null==i&&(i={weight:0}),this.mapx=t,this.mapy=e,this.weight=i.weight,this.frame=i.frame,this.name=i.name,this.object=i.object,this.clean()}return t.prototype.clean=function(){},t.prototype.toString=function(){return"["+this.mapx+","+this.mapy+"]"},t.prototype.calcDirection=function(t){return e.Graph.direction(this,t)},t.prototype.calcDirectionTo=function(t){return e.Graph.direction(this,t)},t.prototype.calcDirectionBy=function(t){return e.Graph.direction(t,this)},t.prototype.isWall=function(){var t;return 0===this.weight||(null!=(t=this.options)?t.isWall:void 0)},t}()}.call(this),function(){var t,e,i,n,a;i="undefined"!=typeof window&&null!==window?window:global,n=i.nz=null!=(a=i.nz)?a:{},i=void 0,e=n.system.character.directions,t=n.system.character.action_cost,n.Character=function(){function i(t){null==t&&(t={}),n.utils.marge(this,{name:"テストキャラクター",spriteSheet:"character_test",team:"teamA",colorChanges:[],ai:{name:"Default"},maxhp:10,maxsp:100,maxap:6,hp:10,sp:100,mapx:-1,mapy:-1,direction:0,move:{speed:300},armor:{defense:1},weapon:{damage:4,height:48,width:12,range:{start:0,end:120,anticlockwise:!1},speed:600},shot:{damage:2,range:{start:0,end:-120,anticlockwise:!0},distance:256,speed:100}}),n.utils.marge(this,t),this.teamColor&&this.colorChanges.push({from:[255,255,255],to:this.teamColor}),this.commands=[]}return i.prototype._command=function(t){return null==t&&(t=this.commands.length-1),null==this.commands[t]&&(this.commands[t]={},this.clearCommand(t)),this.commands[t]},i.prototype.createAiInfo=function(t){var e;return e={name:this.name,maxhp:this.maxhp,maxsp:this.maxsp,maxap:this.maxap,hp:this.hp,sp:this.sp,mapx:this.mapx,mapy:this.mapy,direction:this.direction,team:this.team},e.move=n.utils.marge({},this.move),e.weapon=n.utils.marge({},this.weapon),e.shot=n.utils.marge({},this.shot),e.ai=n.utils.marge({},this.ai),new n.Character(e)},i.prototype.clearCommand=function(t){var e;e=this._command(t),e.attack=!1,e.actions=[],e.cost=0},i.prototype.clearMoveCommand=function(t){var e,i,n,a,s,r;for(n=this._command(t),i=[],r=n.actions,a=0,s=r.length;s>a;a++)e=r[a],null!=e.move||null!=e.rotate?n.cost-=e.cost:i.push(e);n.actions=i},i.prototype.clearAttackCommand=function(e){var i;return i=this._command(e),i.attack?(i.cost-=t.attack,i.attack=!1,this):this},i.prototype.clearShotCommand=function(t){var e,i,n,a,s,r;for(n=this._command(t),i=[],r=n.actions,a=0,s=r.length;s>a;a++)e=r[a],null!=e.shot?n.cost-=e.cost:i.push(e);n.actions=i},i.prototype.getActionCost=function(t){return this._command(t).cost},i.prototype.getRemnantAp=function(t){return this.maxap-this.getActionCost(t)},i.prototype.getLastDirection=function(t){var e,i,n,a,s,r;for(i=this._command(t),n=this.direction,r=i.actions,a=0,s=r.length;s>a;a++)e=r[a],null!=e.rotate&&(n=e.rotate.direction);return n},i.prototype.getLastPosition=function(t){var e,i,n,a,s,r;for(i=this._command(t),s={mapx:this.mapx,mapy:this.mapy},r=i.actions,n=0,a=r.length;a>n;n++)e=r[n],null!=e.move&&(s=e.move);return s},i.prototype.addMoveCommand=function(t,i){var n,a,s,r,o,h,c;for(n=this._command(t),s=this.getLastDirection(t),h=n.cost,a=0,r=0,o=i.length;o>r;r++)c=i[r],h+a<=this.maxap&&(s!==c.direction?(this.addRotateCommand(t,s,e[s].rotateIndex[c.direction]),s=c.direction):(c.speed=this.move.speed,c.back&&(c.speed*=2),n.actions.push({move:c,cost:c.cost-a})),a=c.cost);return n.cost=h+a,this},i.prototype.addRotateCommand=function(e,i,n){var a,s,r;for(a=this._command(e),e=s=0,r=n;r>=0?r>=s:s>=r;e=r>=0?++s:--s)0!==e&&(a.actions.push({rotate:{direction:(i+e+6)%6,speed:this.move.speed},cost:t.rotate}),a.cost+=t.rotate);return this},i.prototype.setAttackCommand=function(e){var i;return this.isShotCommand(e)?this:(i=this._command(e),i.attack?this:(this.maxap>=t.attack&&(i.cost+=t.attack,i.attack=!0),this))},i.prototype.addShotCommand=function(e,i){var n;return this.isAttackCommand(e)?this:(n=this._command(e),n.actions.push({shot:{rotation:i,distance:this.shot.distance,speed:this.shot.speed},cost:t.shot}),n.cost+=t.shot,this)},i.prototype.isShotCommand=function(t){return this._command(t).actions.some(function(t){return null!=t.shot})},i.prototype.isAttackCommand=function(t){return this._command(t).attack},i.prototype.isMoveCommand=function(t){return this._command(t).actions.some(function(t){return null!=t.move})},i.prototype.isDead=function(){return this.hp<=0},i.prototype.isAlive=function(){return this.hp>0},i}()}.call(this),function(){var t,e;e=nz.system.map.chip.width,t=nz.system.map.chip.height,tm.define("nz.SpriteBattleMap",{superClass:tm.display.CanvasElement,init:function(i){var n,a,s,r,o,h,c;for(this.superInit(),this._chips=[],this._blinks=[],this._activeBlinks=[],this.characterSprites=[],this.map=tm.asset.Manager.get(i).data,this.graph=new nz.Graph({mapdata:this.map,chipdata:tm.asset.Manager.get("chipdata").data}),this.width=this.map.width*e,this.height=this.map.height*t,r=a=0,h=this.map.width;h>=0?h>a:a>h;r=h>=0?++a:--a)for(n=r%2!==0?this.map.height:this.map.height-1,o=s=0,c=n;c>=0?c>s:s>c;o=c>=0?++s:--s)this._initMapChip(r,o);this.cursor=this._createCursor().addChildTo(this),this.setCursorPosition(this.getMapChip(0,0)),this.on("startBattlePhase",function(t){this.cursor.visible=!1}),this.on("endBattlePhase",function(t){this.cursor.visible=!0}),this.on("input_up",this.cursorUp),this.on("input_down",this.cursorDown),this.on("input_left",this.cursorLeft),this.on("input_right",this.cursorRight),this.on("repeat_up",this.cursorUp),this.on("repeat_down",this.cursorDown),this.on("repeat_left",this.cursorLeft),this.on("repeat_right",this.cursorRight)},setCursorPosition:function(t){null!=t&&(null!=t.mapx&&(this.cursor.mapx=t.mapx),null!=t.mapy&&(this.cursor.mapy=t.mapy),this.cursor.x=t.x,this.cursor.y=t.y)},cursorUp:function(){var t,e,i;i=this.cursor,t=i.mapx,e=i.mapy,this.setCursorPosition(this.getMapChip(t,e-1))},cursorDown:function(){var t,e,i;i=this.cursor,t=i.mapx,e=i.mapy,this.setCursorPosition(this.getMapChip(t,e+1))},cursorLeft:function(){var t,e,i,n;n=this.cursor,e=n.mapx,i=n.mapy,t=this.getMapChip(e-1,i),null==t&&(t=this.getMapChip(e-1,i-1)),this.setCursorPosition(t)},cursorRight:function(){var t,e,i,n;n=this.cursor,e=n.mapx,i=n.mapy,t=this.getMapChip(e+1,i),null==t&&(t=this.getMapChip(e+1,i-1)),this.setCursorPosition(t)},findCharacter:function(t,e){var i,n,a,s,r;for(r=[],s=this.characterSprites,n=0,a=s.length;a>n;n++)i=s[n],i.mapx===t&&i.mapy===e&&r.push(i);return r},findCharacterGhost:function(t,e){var i,n,a,s,r,o,h;for(h=[],s=this.characterSprites,n=0,a=s.length;a>n;n++)i=s[n],(null!=(r=i.ghost)?r.mapx:void 0)===t&&(null!=(o=i.ghost)?o.mapy:void 0)===e&&h.push(i.ghost);return h},_createCursor:function(){var i;return i=tm.display.Shape({x:0,y:0,width:e,height:t,strokeStyle:"red",lineWidth:3,visible:!0}),i._render=function(){return this.canvas.strokeRect(0,0,this.width,this.height)},i.render(),i},_dispatchMapChipEvent:function(t){var e;e=tm.event.Event("map."+t.type),e.app=t.app,e.pointing=t.pointing,e.mapx=this.mapx,e.mapy=this.mapy,e.app.currentScene.dispatchEvent(e)},_initMapChip:function(i,n){var a,s,r,o,h,c,p,l,u;p=e,o=t,c=nz.utils.mapxy2screenxy(i,n),l=c.x,u=c.y,h=this.graph.grid[i][n],r=h.frame,s=tm.display.Sprite("map_chip",p,o).addChildTo(this).setPosition(l,u).setFrameIndex(r).setInteractive(!0).setBoundingType("rect").on("pointingstart",this._dispatchMapChipEvent).on("pointingover",this._dispatchMapChipEvent).on("pointingout",this._dispatchMapChipEvent).on("pointingend",this._dispatchMapChipEvent),s.mapx=i,s.mapy=n,s.on("pointingover",this.setCursorPosition.bind(this,s)),tm.display.Label(i+","+n,{fontSize:8}).setPosition(0,o/2-8).addChildTo(s),null!=h.object&&tm.display.Sprite("map_object",p,2*o).setOrigin(.5,.75).addChildTo(s).setFrameIndex(h.object.frame),a=tm.display.RectangleShape({width:p,height:o,strokeStyle:"white",fillStyle:"white"}).addChildTo(this).setPosition(l,u).setInteractive(!0).setAlpha(0).setVisible(!1),null==this._chips[i]&&(this._chips[i]=[]),this._chips[i][n]=s,null==this._blinks[i]&&(this._blinks[i]=[]),this._blinks[i][n]=a},blink:function(t,e){var i,n;i=null!=(n=this._blinks[t])?n[e]:void 0,null!=i&&(i.visible=!0,i.tweener.clear().fade(.5,300).fade(.1,300).setLoop(!0),this._activeBlinks.push(i))},clearBlink:function(){var t,e,i,n;for(n=this._activeBlinks,e=0,i=n.length;i>e;e++)t=n[e],t.visible=!1,t.setAlpha(0),t.tweener.clear();this._activeBlinks.clear()},isBlink:function(t,e){var i,n;return null!=(i=this._blinks[t])&&null!=(n=i[e])?n.visible:void 0},getMapChip:function(t,e){var i;return null!=(i=this._chips[t])?i[e]:void 0}})}.call(this),function(){var t,e,i,n;i=nz.system.map.chip.width,e=nz.system.map.chip.height,t=nz.system.character.directions,n=nz.system.character.stamina_cost,tm.define("nz.SpriteCharacter",{superClass:tm.display.AnimationSprite,init:function(t,e){var i,n,a,s,r,o,h,c;if(this.index=t,this.character=e,this.superInit(this.character.spriteSheet),null!=this.character.colorChanges){for(this.ss=tm.asset.SpriteSheet(this.ss),c=this.ss.image.width,s=this.ss.image.height,i=this.ss.image.getBitmap(0,0,c,s),h=this.character.colorChanges,r=0,o=h.length;o>r;r++)n=h[r],a=this._createColorFilter(n.from,n.to),null!=a&&i.filter(a);this.ss.image=tm.graphics.Canvas().resize(c,s).drawBitmap(i,0,0)}this.checkHierarchy=!0,this.ghost=null,this.body=tm.display.Shape({width:this.width,height:this.height}).addChildTo(this),this.weapon=this.createWeapon(),this.weapon.on("enterframe",this._enterframeWeapon.bind(this)),this.setMapPosition(this.character.mapx,this.character.mapy),this.setDirection(this.character.direction),this.on("startBattlePhase",function(){this.clearGhost()}),this.on("endBattlePhase",function(){}),this.on("startBattleTurn",function(t){this.startAction(t.turn),this._weaponHitFlag=[]}),this.on("endBattleTurn",function(t){this.update=null,this.attack=!1}),this.on("addBallet",function(t){this!==t.owner&&this.isAlive()&&t.ballet.collision.add(this)}),this.on("hitWeapon",function(t){this._hitWeapon(t.owner)}),this.on("hitBallet",function(t){this._hitBallet(t.owner,t.ballet)}),this.on("deadCharacter",function(t){var e;e=t.character,t.character===this.character&&this.hide()})},isGhost:function(){return.5===this.alpha},hasGhost:function(){return null!==this.ghost},_createColorFilter:function(t,e){return 3===e.length?{calc:function(i,n,a,s,r){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]?r.setPixelIndex(n,e[0],e[1],e[2]):void 0}}:4===t.length&&4===e.length?{calc:function(i,n,a,s,r){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]?r.setPixel32Index(n,e[0],e[1],e[2],e[3]):void 0}}:void 0},createWeapon:function(){var t;return t=tm.display.RectangleShape({width:this.character.weapon.height,height:this.character.weapon.width,strokeStyle:"black",fillStyle:"red"}).addChildTo(this.body).setOrigin(0,.5).setVisible(!1),t.checkHierarchy=!0,t},createGhost:function(t){var e,i,n;return e=t.direction,i=t.mapx,n=t.mapy,this.clearGhost(),this.ghost=nz.SpriteCharacter(this.index,this.character).setAlpha(.5).setMapPosition(i,n).setDirection(e),this.ghost},clearGhost:function(){null!=this.ghost&&(this.ghost.remove(),this.ghost=null)},setMapPosition:function(t,e){var i;return this.mapx=t,this.mapy=e,i=nz.utils.mapxy2screenxy(this),this.x=i.x,this.y=i.y,this},setDirection:function(e){var i;return this.direction=e,i=t[this.direction],this.body.rotation=i.rotation,this.gotoAndPlay(i.name),this},updateBattle:function(){var t,e,i,n,a,s;for(s=this.getRoot(),a=s.characterSprites,e=i=0,n=a.length;n>i;e=++i)t=a[e],this.index!==e&&t.isAlive()&&this._updateAttack(t)},checkDirection:function(t){var e,i,n,a,s,r,o,h,c;return a=t.r,c=t.start,n=t.end,e=t.anticlockwise,i=t.callback,null==a&&(a=nz.utils.relativeRotation(this.body.rotation,this,t)),s=e?n:c,r=e?c:n,h=!1,h=r>s?a>=s&&r>=a:a>=s||r>=a,null!=i&&(o=a,h||(s>a&&(o=s),a>r&&(o=r)),i(h,o)),h},_checkAttackDirection:function(t){return t.x-=this.width/2,t.y-=this.height/2,this.checkDirection(t)?!0:(t.x+=this.width,this.checkDirection(t)?!0:(t.y+=this.height,this.checkDirection(t)?!0:(t.x-=this.width,this.checkDirection(t)?!0:!1)))},_updateAttack:function(t){var e,i,n;this.attack&&this.character.team!==t.character.team&&(e=this.character.weapon,i=t.position.distance(this.position),i<e.height+this.body.width/2&&(n=t.position.clone().$extend(e.range),this._checkAttackDirection(n)&&(this._attackAnimation(),this.attack=!1)))},_enterframeWeapon:function(t){var e,i,n,a,s,r;if(this.weapon.visible)for(r=this.getRoot(),s=r.characterSprites,i=n=0,a=s.length;a>n;i=++n)e=s[i],this.index===i||this._weaponHitFlag[i]||this._isHitWeapon(e)&&(e.flare("hitWeapon",{owner:this}),this._weaponHitFlag[i]=!0)},_isHitWeapon:function(t){var e,i,n,a;for(a=e=16,i=this.weapon.width;i>e;a=e+=8)if(n=tm.geom.Vector2(0,0),n.setDegree(this.weapon.rotation+this.body.rotation,a),n=this.localToGlobal(n),t.isHitPoint(n.x,n.y))return!0;return!1},startAction:function(t){var e,i,n,a,s;if(this.tweener.clear(),this.move=!1,this.attack=!1,this.action=!0,this.mapx=this.character.mapx,this.mapy=this.character.mapy,this.direction=this.character.direction,i=this.character.commands[t],null!=i){for(this.attack=i.attack,s=i.actions,n=0,a=s.length;a>n;n++)e=s[n],null!=e.shot&&this._setShotAction(e.shot),null!=e.move&&this._setMoveAction(e.move),null!=e.rotate&&this._setRotateAction(e.rotate),this.attack&&this.tweener.call(this.updateBattle,this,[]);this.tweener.call(this._endAction,this,[])}else this._endAction()},applyPosition:function(){this.character.mapx=this.mapx,this.character.mapy=this.mapy,this.character.direction=this.direction},_endAction:function(){this.applyPosition(),this.move=!1,this.action=!1,this.attack&&(this.updateBattle(),this.update=this.updateBattle),this.tweener.clear()},isMove:function(){return this.move},isStop:function(){return!this.move},isDead:function(){return this.character.isDead()},isAlive:function(){return this.character.isAlive()},_setShotAction:function(t){this.tweener.call(this._shotAnimation,this,[t]),this.tweener.call(this._fatigue,this,[n.shot])},_setMoveAction:function(t){var e,i,a,s;this.move=!0,this.mapx=t.mapx,this.mapy=t.mapy,i=t.speed,e=nz.utils.mapxy2screenxy(this),a=e.x,s=e.y,this.tweener.move(a,s,i),this.tweener.call(this._fatigue,this,[n.move])},_setRotateAction:function(t){var e,i;return e=t.direction,i=t.speed,this.tweener.wait(i),this.tweener.call(this.setDirection,this,[e]),this.tweener.call(this._fatigue,this,[n.rotate])},_attackAnimation:function(){var t,e,i;return t=this.action,this.action=!0,i=function(){return this.weapon.visible=!1,this.weapon.rotation=0,this.tweener.play(),this.action=t,this._fatigue(n.attack)},this.tweener.pause(),e=this.character.weapon,this.weapon.visible=!0,this.weapon.rotation=e.range.start,this.weapon.tweener.clear().wait(50).rotate(e.range.end,e.speed).call(i,this,[])},_shotAnimation:function(t){var e,i,n,a,s,r,o,h,c,p,l,u;o=t.rotation,a=t.distance,c=t.speed,h=this.getRoot(),n=h.mapSprite.globalToLocal(this.localToGlobal(this.body.position)),i=tm.display.CircleShape({x:n.x,y:n.y,width:10,height:10}).addChildTo(h.mapSprite),e=Math.degToRad(o),p=a*Math.cos(e)+n.x,l=a*Math.sin(e)+n.y,c=c*a/32,r={ballet:i,owner:this},u=h.eventHandler,s=function(){return i.remove(),u.removeBallet(r)},i.tweener.move(p,l,c).call(s,this,[]),i.on("collisionenter",function(t){return t.other.flare("hitBallet",r),i.tweener.clear().call(s,this,[])}),u.addBallet(r)},_deadAnimation:function(t){},_hitBallet:function(t,e){this._damage(t.character.shot.damage-this.character.armor.defense)},_hitWeapon:function(t){this._damage(t.character.weapon.damage-this.character.armor.defense)},_damage:function(t){var e;0>=t||(this.character.hp-=t,e=this.getRoot().eventHandler,e.refreshStatus(),this.character.hp<=0&&e.deadCharacter(this.character))},_fatigue:function(t){var e;0>=t||(this.character.sp-=t,e=this.getRoot().eventHandler,e.refreshStatus())}})}.call(this),function(){var t;t=nz.system.character.directions,tm.define("nz.SpriteStatus",{superClass:tm.display.CanvasElement,init:function(t){var e;return this.index=t.index,this.character=t.character,this.characterSprite=t.characterSprite,this.detail=t.detail,this.superInit(),this.setOrigin(0,0),this.width=160,this.height=80,this.alpha=1,this.boundingType="rect",this.interactive=!0,this.checkHierarchy=!0,this.bgColor="blanchedalmond",e={children:{bg:{type:"RoundRectangleShape",width:this.width,height:this.height,strokeStyle:"black",fillStyle:this.bgColor,lineWidth:1,shadowBlur:1,shadowOffsetX:2,shadowOffsetY:2,shadowColor:"gray",originX:this.originX,originY:this.originY},name:this._label({text:this.character.name,fontSize:8,fillStyle:"black",stroke:!1,x:8,y:10}),action:this._label({text:"",fontSize:8,fillStyle:"black",stroke:!1,x:8,y:20}),hpGauge:this._gauge({y:38,color:"Green",_maxValue:this.character.maxhp}),spGauge:this._gauge({y:50,color:"DarkSlateBlue",_maxValue:this.character.maxsp}),hpLabel:this._label({text:"HP",fontSize:12,x:10,y:32}),spLabel:this._label({text:"SP",fontSize:12,x:10,y:44})}},this.fromJSON(e),this.sprite=tm.display.AnimationSprite(this.characterSprite.ss).addChildTo(this),this.sprite.x=this.width-40,this.sprite.y=10,this.sprite.setScale(.5,.5),this.sprite.setOrigin(0,0),this.on("refreshStatus",this.refreshStatus),this.eventHandler=nz.EventHandlerBattle(),this.on("pointingend",function(){return this.eventHandler.selectStatus({status:this})})},_gauge:function(t){return{type:"tm.ui.GlossyGauge",x:8,y:0,width:this.width-16,height:6,originX:this.originX,originY:this.originY,borderWidth:1,color:"green",bgColor:this.bgColor,borderColor:"gray",animationTime:1e3}.$extend(t)},_label:function(t){return{type:"Label",fillStyle:"white",strokeStyle:"black",lineWidth:2,stroke:!0,align:"left",baseline:"top",originX:this.originX,originY:this.originY,fontSize:12,text:"null"}.$extend(t)},refreshStatus:function(e){var i;return i=e.turn,this.sprite.gotoAndPlay(t[this.characterSprite.direction].name),this._refreshActionText(i),this.hpGauge.value=this.character.hp,this.spGauge.value=this.character.sp},_refreshActionText:function(t){var e,i,n;return n="Action: ",this.detail?(i=this.character.getRemnantAp(t),e=[],this.character.isAttackCommand(t)&&e.push("Attack"),this.character.isShotCommand(t)&&e.push("Shot"),this.character.isMoveCommand(t)&&e.push("Move"),n+=e.join(" & "),n+=" (AP="+i+")"):n+="???",this.action.text=n}})}.call(this),function(){tm.define("nz.EventHandlerBattle",{init:function(){},_fireAll:function(t,e){var i,n;null==e&&(e={}),i=nz.system.app,n=i.currentScene,"string"==typeof t&&(t=tm.event.Event(t),t.app=i,t.scene=n,t.turn=n.turn,t.$extend(e)),this._dispatchEvent(t,n)},_dispatchEvent:function(t,e){var i,n,a,s;for(e.hasEventListener(t.type)&&e.fire(t),s=e.children,n=0,a=s.length;a>n;n++)i=s[n],null!=i&&this._dispatchEvent(t,i)},refreshStatus:function(){this._fireAll("refreshStatus")},deadCharacter:function(t){this._fireAll("deadCharacter",{character:t})},startBattlePhase:function(){this._fireAll("startBattlePhase")},endBattlePhase:function(){this._fireAll("endBattlePhase")},startBattleTurn:function(){this._fireAll("startBattleTurn")},endBattleTurn:function(){this._fireAll("endBattleTurn")},addBallet:function(t){this._fireAll("addBallet",t)},removeBallet:function(t){this._fireAll("removeBallet",t)},selectStatus:function(t){this._fireAll("selectStatus",t)}})}.call(this),function(){var t,e;e=nz.system.screen.width,t=nz.system.screen.height,tm.define("nz.SceneBase",{superClass:tm.app.Scene,init:function(){this.superInit()},openMenuDialog:function(t){var e;return e=nz.SceneMenu(t),this.app.pushScene(e),e},description:function(i){return this._description||(this._description=tm.display.Label("",14).addChildTo(this).setAlign("center").setBaseline("middle").setPosition(e/2,t-10)),this._description.text=i},createKeyboradHander:function(){var t,e,i,n;return t=["up","down","left","right","enter"],e=0,i=10,n=0,function(a){var s,r,o,h,c,p,l,u,m;for(s=null!=(u=this.app)?u:a.app,h=s.keyboard,r=0,p=t.length;p>r;r++)c=t[r],h.getKeyDown(c)&&(e=0,this.fire(tm.event.Event("input_"+c)));for(m=[],o=0,l=t.length;l>o;o++)c=t[o],h.getKey(c)&&(i<e++?(this.fire(tm.event.Event("repeat_"+c)),m.push(e-=n)):m.push(void 0));return m}},setupCursorHandler:function(t){var e,i,n,a;for(a=["up","down","left","right"],e=0,n=a.length;n>e;e++)i=a[e],this.on("input_"+i,t),this.on("repeat_"+i,t)}})}.call(this),function(){var t,e;e=nz.system.screen.width,t=nz.system.screen.height,tm.define("nz.SceneMenu",{superClass:tm.ui.MenuDialog,init:function(i){var n,a;i={self:this,screenWidth:e,screenHeight:t}.$extend(i),this.menuFunc=function(){var t,e,n,s;for(n=i.menu,s=[],t=0,e=n.length;e>t;t++)a=n[t],null!=a.func&&s.push(a.func);return s}(),i.menu=function(){var t,e,n,s;for(n=i.menu,s=[],t=0,e=n.length;e>t;t++)a=n[t],null!=a.name&&s.push(a.name);return s}(),i.menuDesctiptions=function(){var t,e,n,s;for(n=i.menu,s=[],t=0,e=n.length;e>t;t++)a=n[t],null!=a.desctiption&&s.push(a.desctiption);return s}(),this.superInit(i),this.box.setStrokeStyle(nz.system.dialog.strokeStyle),this.box.setFillStyle(nz.system.dialog.fillStyle),n=null,this.on("menuselected",function(t){n=t.selectIndex}),this.on("menuclosed",function(t){var e;null!=n&&null!=(e=this.menuFunc[n])&&e.call(i.self,n)}),this.on("enterframe",function(t){var e,i;e=t.app,i=e.keyboard,i.getKeyDown("up")?this.up():i.getKeyDown("down")?this.down():i.getKeyDown("enter")&&this.closeDialog(this._selected)})},up:function(){this.setIndex(this._selected-1)},down:function(){this.setIndex(this._selected+1)},setIndex:function(t){this._selected=(t+this.menu.length)%this.menu.length,this.selectValue=this.menu[this._selected],this.selectIndex=this._selected,this.dispatchEvent(tm.event.Event("menuselect"))}})}.call(this),function(){tm.define("nz.SceneTitleMenu",{superClass:nz.SceneBase,init:function(){var t;this.superInit(),t=[{name:"New Game",desctiption:"新しいゲームをはじめる",func:this._new_game},{name:"Load Game",desctiption:"保存したゲームをはじめる",func:this._load_game},{name:"Option",desctiption:"ゲームオプション",func:this._option},{name:"Debug Game",desctiption:"デバックゲーム",func:this._debug_game}],this.on("enter",function(){var t;return t=tm.game.TitleScene({title:nz.system.title}),t.on("enterframe",function(){return this.app.keyboard.getKeyDown("enter")?this.onpointingstart():void 0}),this.app.pushScene(t)}),this.on("resume",function(){return this.openMenuDialog({self:this,title:nz.system.title,menu:t})})},_new_game:function(){this.app.replaceScene(nz.SceneBattle({mapId:1,controlTeam:["teamA"],characters:[{name:"キャラクター1",team:"teamA"},{name:"キャラクター2",team:"teamA"},{name:"キャラクター3",team:"teamA"},{name:"キャラクター4",team:"teamB"},{name:"キャラクター5",team:"teamB"},{name:"キャラクター6",team:"teamB"}]}))},_load_game:function(){console.log("load game")},_option:function(){console.log("option")},_debug_game:function(){this.app.replaceScene(nz.SceneBattle({mapId:0,controlTeam:["teamA"],characters:[{name:"キャラクター3",team:"teamA",spriteSheet:"character_test",ai:{name:"Runner",src:"nz/ai/Runner.js"
}},{name:"キャラクター6",team:"teamB",spriteSheet:"character_test",ai:{name:"Shooter",src:"nz/ai/Shooter.js"}}]}))}})}.call(this),function(){var t,e,i,n;n=nz.system.screen.width,i=nz.system.screen.height,e=nz.system.character.directions,t=nz.system.character.action_cost,tm.define("nz.SceneBattle",{superClass:nz.SceneBase,init:function(t){var e,i,n,a,s;for(this.mapId=t.mapId,this.characters=t.characters,this.controlTeam=t.controlTeam,this.endCondition=t.endCondition,this.superInit(),this.mapName="map_"+(""+this.mapId).paddingLeft(3,"0"),this._selectCharacterIndex=0,null==this.endCondition&&(this.endCondition={type:"team",turn:20}),s=this.characters,i=n=0,a=s.length;a>n;i=++n)e=s[i],e instanceof nz.Character||(this.characters[i]=new nz.Character(e));this.data={turn:0,winner:null,replay:null,startInfo:{}},this.eventHandler=nz.EventHandlerBattle(),this.on("enter",this.load.bind(this))},load:function(){var t,e,a,s,r,o,h,c,p;for(r=!0,t={},tm.asset.Manager.contains(this.mapName)||(t[this.mapName]="data/"+this.mapName+".json",r=!1),o=this.characters,a=0,s=o.length;s>a;a++)e=o[a],tm.asset.Manager.contains(e.ai.name)||(p=null!=(h=e.ai.src)?h:"nz/ai/"+e.ai.name+".js",null==nz.system.ai[e.ai.name]&&(t[e.ai.name]=p,r=!1));r?this.setup():(c=tm.game.LoadingScene({assets:t,width:n,height:i,autopop:!0}),c.on("load",this.setup.bind(this)),this.app.pushScene(c))},setup:function(){var t,e,a,s,r,o,h,c,p,l;for(h=this,this.mapSprite=nz.SpriteBattleMap(this.mapName).addChildTo(this),this.mapSprite.x=n-this.mapSprite.width-32,this.mapSprite.y=(i-this.mapSprite.height)/2,this.status=tm.display.CanvasElement().addChildTo(this),p=l=0,r=this.characters,e=a=0,s=r.length;s>a;e=++a)t=r[e],c=nz.SpriteCharacter(e,t).setVisible(!1).addChildTo(this.mapSprite),this.characterSprites.push(c),o=nz.SpriteStatus({index:e,character:t,characterSprite:c,detail:this.controlTeam.contains(t.team)}),o.setPosition(p,l),this.status.addChildAt(o,0),l+=72;this.on("selectStatus",function(t){var e;return h=t.scene,e=t.status,h.activeStatus(e),h.blinkCharacter(e.index)}),this.on("map.pointingend",this._mapPointingend),this.one("enterframe",function(){return this._pushScene(nz.SceneBattlePosition({mapSprite:this.mapSprite,controlTeam:this.controlTeam})),this.one("resume",function(){var t,e,i,n;for(this.data.startInfo.characters=[],n=this.characters,e=0,i=n.length;i>e;e++)t=n[e],this.data.startInfo.characters.push({mapx:t.mapx,mapy:t.mapy,direction:t.direction,hp:t.hp,sp:t.sp});return this._startInputPhase()})}),this.eventHandler.refreshStatus(),this.on("enterframe",this.createKeyboradHander()),this.on("input_enter",this.inputEnter),this.setupCursorHandler(this.cursorHandler)},cursorHandler:function(t){return this.mapSprite.fire(t)},inputEnter:function(t){return this._mapPointingend(this.mapSprite.cursor)},_mapPointingend:function(t){var e,i,n,a,s,r,o;for(n=t.mapx,a=t.mapy,this.mapSprite.clearBlink(),o=this.mapSprite.findCharacterGhost(n,a),s=this.mapSprite.findCharacter(n,a),e=0,i=s.length;i>e;e++)r=s[e],r.isAlive()&&(r.hasGhost()&&r.ghost.mapx===n&&r.ghost.mapy===a||o.push(r));o=function(){var t,e,i;for(i=[],t=0,e=o.length;e>t;t++)r=o[t],this.controlTeam.contains(r.character.team)&&i.push(r);return i}.call(this),0===o.length?this._openGameMenu():1===o.length?this._openCommandMenu(o[0]):this._openSelectCharacterMenu(o)},activeStatus:function(t){this.status.addChild(t)},blinkCharacter:function(t){var e;e=this.characterSprites[t],this.mapSprite.clearBlink(),this.mapSprite.blink(e.mapx,e.mapy),e.hasGhost()&&this.mapSprite.blink(e.ghost.mapx,e.ghost.mapy)},_createResultTimeup:function(){var t,e,i,n,a,s,r,o,h,c;for(a="",r=0,o={},s=this.characters,e=0,n=s.length;n>e;e++)t=s[e],t.isAlive()&&(null==o[t.team]?o[t.team]=t.hp:o[t.team]+=t.hp,r<o[t.team]&&(a=t.team,r=o[t.team]));c=[{name:a,score:r}];for(i in o)h=o[i],a!==i&&r===h&&c.push({name:i,score:h});this.data.result=1===c.length?{winner:c[0]}:{draw:c}},_createResultTeam:function(){var t,e,i,n,a;for(a=null,n=this.characters,e=0,i=n.length;i>e;e++)if(t=n[e],t.isAlive())if(null==a)a=t.team;else if(a!==t.team)return;this.data.result={winner:{name:a}}},_createResult:function(){return this.turn>=this.endCondition.turn?void this._createResultTimeup():"team"===this.endCondition.type?void this._createResultTeam():void 0},isEnd:function(){return null!=this.data.result},_pushScene:function(t){this.eventHandler.refreshStatus(),this.one("pause",function(){this.mapSprite.addChildTo(t),this.status.addChildTo(t)}),this.one("resume",function(){this.mapSprite.addChildTo(this),this.status.addChildTo(this),this.eventHandler.refreshStatus()}),this.mapSprite.remove(),this.status.remove(),this.app.pushScene(t)},_commandScene:function(t,e){var i;i=this.selectCharacterSprite,this._selectGhost&&(i=this.selectCharacterSprite.ghost),this._pushScene(t({turn:this.turn,target:i,callback:e,mapSprite:this.mapSprite,status:this.status,characters:this.characters})),this.one("resume",this._checkCommandConf.bind(this))},_openGameMenu:function(){this.openMenuDialog({self:this,title:"Command?",menu:[{name:"Next Turn",func:this._openTurnConfMenu},{name:"Option",func:function(){}},{name:"Exit Game",func:this._exitGame},{name:"Close Menu"}]})},_openSelectCharacterMenu:function(t){var e,i,n,a;for(n=[],e=0,i=t.length;i>e;e++)a=t[e],n.push({name:a.character.name,func:function(e){return this._openCommandMenu(t[e])}});n.push({name:"Close Menu"}),this.openMenuDialog({self:this,title:"Select Character",menu:n})},_openCommandMenu:function(e){var i,n,a,s,r,o,h,c,p,l;for(this._selectCharacterIndex=e.index,this._selectGhost=e.isGhost(),h=this.status.children,a=0,s=h.length;s>a;a++)c=h[a],c.index===e.index&&this.activeStatus(c);r=[],p=this.selectCharacter,i=p.getActionCost(this.turn),o=p.getRemnantAp(this.turn),(this._selectGhost||!this._selectGhost&&!e.hasGhost())&&(o>=t.move&&r.push({name:"Move",func:this._addMoveCommand}),o>=t.rotate&&r.push({name:"Rotate",func:this._addRotateCommand}),o>=t.attack&&(n=p.isAttackCommand(this.turn),l=p.isShotCommand(this.turn),n||l||(r.push({name:"Attack",func:this._addAttackCommand}),r.push({name:"Shot",func:this._addShotCommand})))),i>0&&r.push({name:"Reset Action",func:this._resetCommand}),r.push({name:"Close Menu"}),this.openMenuDialog({self:this,title:p.name,menu:r})},_openTurnConfMenu:function(){this.openMenuDialog({self:this,title:"Start Battle?",menu:[{name:"Yes",func:function(){return this._startBattlePhase()}},{name:"No"}]})},_checkCommandConf:function(){var t,e,i,n;for(n=this.characters,e=0,i=n.length;i>e;e++)if(t=n[e],this.controlTeam.contains(t.team)&&t.isAlive()&&t.getRemnantAp(this.turn)>0)return;this._openTurnConfMenu()},_openResult:function(){this._pushScene(nz.SceneBattleResult({mapSprite:this.mapSprite,status:this.status,data:this.data})),this.one("resume",function(){this._startReplay()})},_startReplay:function(){var t,e,i,n,a,s,r,o;if(null!=this.data.replay){for(o=this.data.startInfo,s=this.characterSprites,e=i=0,n=s.length;n>i;e=++i)r=s[e],t=r.character,a=o.characters[e],t.hp=a.hp,t.sp=a.sp,r.setMapPosition(a.mapx,a.mapy),r.setDirection(a.direction),r.applyPosition(),r.show();this._startBattlePhase(this.data.replay)}},_exitGame:function(){nz.system.restart()},_startInputPhase:function(){var t,e,i,n,a,s;for(this.data.turn+=1,console.log("battle turn "+this.data.turn),e=this.characters.map(function(t){return t.createAiInfo()}),i=n=0,a=e.length;a>n;i=++n)t=e[i],!this.controlTeam.contains(t.team)&&t.isAlive()&&(null!=(s=nz.system.ai[t.ai.name])&&s.setupAction(new nz.ai.Param({character:t,characters:e,graph:this.mapSprite.graph,turn:this.turn})),this.characters[i].commands[this.turn]=t.commands[this.turn]);return this.eventHandler.refreshStatus(),0===this.controlTeam.length?this._startBattlePhase():void 0},_startBattlePhase:function(t){var e,i,n;i={start:this.turn,end:this.turn}.$extend(t),n=i.start,e=i.end,this._pushScene(nz.SceneBattlePhase({start:n,end:e,mapSprite:this.mapSprite,status:this.status})),this.one("resume",function(){return this._createResult(),this.isEnd()?this._openResult():this._startInputPhase()})},_addMoveCommand:function(){this._commandScene(nz.SceneBattleMoveCommand,function(t){var e;e=this.selectCharacter,e.addMoveCommand(this.turn,t),t.length>0&&this.selectCharacterSprite.createGhost(t[t.length-1]).addChildTo(this.mapSprite),e.getRemnantAp(this.turn)>0&&(this._selectGhost=!0,this.one("enterframe",this._addRotateCommand))}.bind(this))},_addAttackCommand:function(){var t,e;t=this.selectCharacter,t.setAttackCommand(this.turn),e=this.selectCharacterSprite,e.hasGhost()||e.isGhost()||e.createGhost(e).addChildTo(this.mapSprite),this.eventHandler.refreshStatus(),t.getRemnantAp(this.turn)>0?(this._selectGhost=!0,this.one("enterframe",this._addMoveCommand)):this._checkCommandConf()},_addShotCommand:function(){this._commandScene(nz.SceneBattleShotCommand,function(t){var e,i;e=this.selectCharacter,i=this.selectCharacterSprite,e.addShotCommand(this.turn,t),i.hasGhost()||i.isGhost()||i.createGhost(i).addChildTo(this.mapSprite),e.getRemnantAp(this.turn)>0&&(this._selectGhost=!0,this.one("enterframe",this._addMoveCommand))}.bind(this))},_addRotateCommand:function(){this._commandScene(nz.SceneBattleDirectionCommand,function(t,i){var n,a;n=this.selectCharacter,a=this.selectCharacterSprite,n.addRotateCommand(this.turn,t,e[t].rotateIndex[i]),a.hasGhost()||a.createGhost(a).addChildTo(this.mapSprite),a.ghost.setDirection(i)}.bind(this))},_resetCommand:function(){this.selectCharacter.clearCommand(),this.selectCharacterSprite.clearGhost(),this.eventHandler.refreshStatus()}}),nz.SceneBattle.prototype.getter("characterSprites",function(){return this.mapSprite.characterSprites}),nz.SceneBattle.prototype.getter("selectCharacterSprite",function(){return this.characterSprites[this._selectCharacterIndex]}),nz.SceneBattle.prototype.getter("selectCharacter",function(){return this.selectCharacterSprite.character}),nz.SceneBattle.prototype.getter("turn",function(){return this.data.turn})}.call(this),function(){var t,e;e=nz.system.messages,t=nz.system.direction_num,tm.define("nz.SceneBattlePosition",{superClass:nz.SceneBase,init:function(t){var e,i,n,a,s,r,o,h,c,p,l,u,m,d,f,g,y,v;for(this.superInit(),this.mapSprite=t.mapSprite,this.controlTeam=t.controlTeam,this.otherTeam=[],this.teamArea={},this.members={},i=0,d=this.mapSprite.characterSprites,r=0,c=d.length;c>r;r++)n=d[r],v=n.character.team,null==this.members[v]&&(this.members[v]=[],this.teamArea[v]=this.mapSprite.map.start.area[i].clone(),this.controlTeam.contains(v)||this.otherTeam.push(v),i+=1),this.members[v].push(n);for(f=this.otherTeam,o=0,p=f.length;p>o;o++)for(v=f[o],e=this.teamArea[v],a=function(){var t,e,i,n;for(i=this.members[v],n=[],t=0,e=i.length;e>t;t++)u=i[t],n.push(u.character);return n}.call(this),g=this.members[v],s=h=0,l=g.length;l>h;s=++h)u=g[s],n=u.character,m=null!=(y=nz.system.ai[n.ai.name])?y.setupBattlePosition({character:n,friends:a,area:e}):void 0,null==m&&(m=e[s]),this._setBattlePosition(u,m[0],m[1]),u.applyPosition();return this.on("map.pointingover",this._mapPointingover),this.on("map.pointingend",this._mapPointingend),this.on("enter",this._start),this.on("enterframe",this.createKeyboradHander()),this.on("input_enter",this.inputEnter),this.setupCursorHandler(this.cursorHandler)},cursorHandler:function(t){return this.mapSprite.fire(t),this._mapPointingover(this.mapSprite.cursor)},inputEnter:function(t){return this._mapPointingend(this.mapSprite.cursor)},_start:function(){var t,i,n,a;for(a=this.mapSprite.characterSprites,i=0,n=a.length;n>i;i++)if(t=a[i],!t.visible&&this.controlTeam.contains(t.character.team))return this._selectCharacter(t),void this.description(e.battle.position.setiing.format({name:t.character.name}));this._end()},_end:function(){var e,i,n,a,s;for(a=this.mapSprite.map.width/2,s=this.mapSprite.characterSprites,i=0,n=s.length;n>i;i++)e=s[i],e.visible=!0,e.mapy<a?(e.character.direction=t.DOWN,e.setDirection(t.DOWN)):(e.character.direction=t.UP,e.setDirection(t.UP));this.mapSprite.clearBlink(),this.one("enterframe",function(){return this.app.popScene()})},_selectCharacter:function(t){var e,i,n,a,s;for(this.character=t,this.mapSprite.clearBlink(),a=this.teamArea[this.character.character.team],s=[],e=0,i=a.length;i>e;e++)n=a[e],s.push(0===this.mapSprite.findCharacter(n[0],n[1]).length?this.mapSprite.blink(n[0],n[1]):void 0);return s},_setBattlePosition:function(e,i,n){e.setMapPosition(i,n),e.setDirection(e.mapy<this.mapSprite.map.width/2?t.DOWN:t.UP)},_mapPointingover:function(t){var e,i;e=t.mapx,i=t.mapy,this._setBattlePosition(this.character,e,i),this.character.applyPosition(),this.mapSprite.cursor.visible=!0,this.character.visible=!0},_mapPointingend:function(t){var e,i,n,a,s,r,o,h,c,p;if(r=t.mapx,o=t.mapy,this.mapSprite.isBlink(r,o)){for(this._mapPointingover(t),h=this.controlTeam,i=0,a=h.length;a>i;i++)for(p=h[i],c=this.members[p],n=0,s=c.length;s>n;n++)if(e=c[n],!e.visible)return void this._start();this._end()}}})}.call(this),function(){tm.define("nz.SceneBattleMoveCommand",{superClass:nz.SceneBase,init:function(t){return this.superInit(),this.turn=t.turn,this.target=t.target,this.callback=t.callback,this.mapSprite=t.mapSprite,this.characters=t.characters,this.on("map.pointingover",this._over),this.on("map.pointingend",this._end),this.on("enterframe",this.createKeyboradHander()),this.setupCursorHandler(function(t){return this.mapSprite.fire(t),this._over(this.mapSprite.cursor)}),this.on("input_enter",this.inputEnter)},inputEnter:function(t){return this._end(this.mapSprite.cursor)},searchRoute:function(t){var e,i;return e={graph:{cost:this.target.character.getRemnantAp(this.turn)}},i=nz.utils.searchRoute(this.mapSprite.graph,this.target,t,this.characters,e)},_end:function(t){this.mapSprite.isBlink(t.mapx,t.mapy)&&this.callback(this.searchRoute(t)),this.mapSprite.clearBlink(),this.one("enterframe",function(){return this.app.popScene()})},_over:function(t){var e,i,n,a,s,r;for(this.mapSprite.clearBlink(),e=this.target.character.getRemnantAp(this.turn),r=this.searchRoute(t),s=[],i=0,n=r.length;n>i;i++)a=r[i],a.cost<=e&&s.push(this.mapSprite.blink(a.mapx,a.mapy));return s}})}.call(this),function(){tm.define("nz.SceneBattleShotCommand",{superClass:nz.SceneBase,init:function(t){return this.superInit(),this.turn=t.turn,this.target=t.target,this.callback=t.callback,this.mapSprite=t.mapSprite,this.costa=this.target.character.getActionCost(this.turn),this._keyInput=!0,this._keyRotate=0,this.on("enterframe",this.createKeyboradHander()),this.on("input_left",this._inputLeft),this.on("repeat_left",this._inputLeft),this.on("input_right",this._inputRight),this.on("repeat_right",this._inputRight),this.on("map.pointingover",function(){return this._keyInput=!1}),this.on("map.pointingend",this._pointEnd),this._createPointer()},_inputLeft:function(){this._keyInput=!0,this._keyRotate-=5,this._rotatePointer(this._keyRotate)},_inputRight:function(){this._keyInput=!0,this._keyRotate+=5,this._rotatePointer(this._keyRotate)},_rotatePointer:function(t){var e;null!=this.pointer&&(e=this.target.character.shot.range,t=nz.utils.relativeRotation(this.target.body.rotation,t),this.target.checkDirection({r:t,start:e.start,end:e.end,anticlockwise:e.anticlockwise,callback:function(t,e){return e+=this.target.body.rotation,t||(this._keyRotate=e),this.pointer.rotation=e}.bind(this)}))},update:function(t){this._keyInput||this._movePointer(t.pointing)},_pointStart:function(t){this._movePointer(t.pointing)},_pointMove:function(t){this._movePointer(t.pointing)},_pointEnd:function(t){this._setupCommand(),this._removePointer(),this._endScene()},_setupCommand:function(){null!=this.pointer&&this.callback(this.pointer.rotation)},_endScene:function(){this.one("enterframe",function(){return this.app.popScene()})},_createPointer:function(){this.pointer=tm.display.Shape({width:10,height:10}).addChildTo(this.mapSprite).setPosition(this.target.x,this.target.y),tm.display.CircleShape({x:40,width:10,height:10,fillStyle:"blue"}).addChildTo(this.pointer),this.pointer.rotation=this.target.body.rotation},_removePointer:function(){null!=this.pointer&&(this.pointer.remove(),this.pointer=null)},_movePointer:function(t){var e,i;null!=this.pointer&&(e=this.mapSprite.globalToLocal(t),i=this.target.character.shot.range,this.target.checkDirection({x:e.x,y:e.y,start:i.start,end:i.end,anticlockwise:i.anticlockwise,callback:function(t,i){var n,a,s;return t?(a=e.x-this.target.x,s=e.y-this.target.y,n=tm.geom.Vector2(a,s),i=Math.radToDeg(n.toAngle())):i+=this.target.body.rotation,this.pointer.rotation=i}.bind(this)}))}})}.call(this),function(){var t;t=nz.system.character.directions,tm.define("nz.SceneBattleDirectionCommand",{superClass:nz.SceneBattleShotCommand,init:function(t){return this.superInit(t),this._direction=null},_setupCommand:function(){null!=this._direction&&this.callback(this.target.direction,this._direction)},_movePointer:function(e){var i,n,a,s,r,o,h,c,p,l;if(null!=this.pointer)for(h=this.target.body.localToGlobal(tm.geom.Vector2(0,0)),p=e.x-h.x,l=e.y-h.y,c=tm.geom.Vector2(p,l),o=Math.radToDeg(c.toAngle()),a=s=0,r=t.length;r>s;a=++s)if(n=t[a],a>=0&&6>a&&n.rotation-30<o&&o<n.rotation+30&&(i=nz.Graph.directionCost(this.target.direction,n.index),this.costa+i<=this.target.character.maxap&&this._direction!==n.index))return this._direction=n.index,void(this.pointer.rotation=n.rotation)}})}.call(this),function(){tm.define("nz.SceneBattlePhase",{superClass:nz.SceneBase,init:function(t){var e,i;this.superInit(),this.mapSprite=t.mapSprite,this.status=t.status,i=t.start,e=t.end,this.startTuen=i,this.endTurn=e,this.turn=i,this.runing=!1,this._balletCount=0,this.eventHandler=nz.EventHandlerBattle(),this.on("enter",this._startPhase),this.on("addBallet",this._addBallet),this.on("removeBallet",this._removeBallet),this.on("map.pointingend",this._openPauseMenu),this.on("enterframe",this.createKeyboradHander()),this.on("input_enter",this._openPauseMenu),this.on("selectStatus",function(t){var e,i;return e=t.scene,i=t.status,e.activeStatus(i)})},activeStatus:function(t){this.status.addChild(t)},_openPauseMenu:function(){this.openMenuDialog({self:this,title:"Pause",menu:[{name:"Continue",func:function(){}},{name:"Exit Game?",func:this._exitGame}]})},_exitGame:function(t){var e,i;e=null!=(i=this.app)?i:t.app,e.popScene(),nz.system.restart()},_removeBallet:function(t){var e;return e=t.ballet,this._balletCount-=1},_addBallet:function(t){var e,i;e=t.ballet,i=t.owner,this._balletCount+=1},_startPhase:function(){this.eventHandler.startBattlePhase(),this._startTurn(this.startTuen)},_endPhase:function(){this.eventHandler.endBattlePhase(),this.app.popScene()},_startTurn:function(t){this.turn=t,this.eventHandler.startBattleTurn(),this.update=this.updateTurn},_endTurn:function(){this.eventHandler.endBattleTurn(),this.update=null},_isEnd:function(){return this.turn>=this.endTurn},_isEndAllCharacterAction:function(){var t;return t=this.characterSprites.filter(function(t){return t.isAlive()}).some(function(t){return t.action}),!t&&0===this._balletCount},updateTurn:function(){this._isEndAllCharacterAction()&&(this._endTurn(),this._isEnd()?this._endPhase():(this._startTurn(this.turn+1),this._isEndAllCharacterAction()&&(this._endTurn(),this._endPhase())))}}),nz.SceneBattlePhase.prototype.getter("characterSprites",function(){return this.mapSprite.characterSprites})}.call(this),function(){var t,e;e=nz.system.screen.width,t=nz.system.screen.height,tm.define("nz.SceneBattleResult",{superClass:nz.SceneBase,init:function(i){return this.superInit(),this.mapSprite=i.mapSprite,this.data=i.data,this.setOrigin(0,0),this.width=e-64,this.height=t-64,this.bgColor="gray",this.boundingType="rect",this.interactive=!0,this.checkHierarchy=!0,this.one("enterframe",this.setup)},setup:function(){var t,e;return t={children:{bg:{type:"RoundRectangleShape",x:32,y:32,width:this.width,height:this.height,strokeStyle:"black",fillStyle:this.bgColor,lineWidth:1,shadowBlur:1,shadowOffsetX:2,shadowOffsetY:2,shadowColor:"gray",originX:this.originX,originY:this.originY},message:{type:"Label",fillStyle:"black",align:"left",baseline:"top",x:40,y:42,originX:this.originX,originY:this.originY,fontSize:8}}},t.children.message.text=null!=this.data.result.winner?"Winner! "+this.data.result.winner.name:"Draw!!! "+function(){var t,i,n,a;for(n=this.data.result.draw,a=[],t=0,i=n.length;i>t;t++)e=n[t],a.push(e.name);return a}.call(this).join(","),this.fromJSON(t),this.on("enterframe",this.createKeyboradHander()),this.on("pointingend",this._openBattleEndMenu),this.on("input_enter",this._openBattleEndMenu)},_startReplay:function(){this.data.replay={start:1,end:this.data.turn},this.app.popScene()},_exitGame:function(){nz.system.restart()},_openBattleEndMenu:function(){this.openMenuDialog({self:this,title:"Battle End",menu:[{name:"Replay?",func:this._startReplay},{name:"Exit Game?",func:this._exitGame}]})}})}.call(this),function(){var t,e,i,n,a;e="undefined"!=typeof window&&null!==window?window:global,i=e.nz=null!=(n=e.nz)?n:{},e=void 0,i.ai=null!=(a=i.ai)?a:{},t=i.system.character.directions,i.ai.Param=function(){function e(t){this.character=t.character,this.characters=t.characters,this.graph=t.graph,this.turn=t.turn,this.setFriendsAndTargets(),this.setNearTarget()}return e.prototype._searchCharacters=function(t,e,n,a){var s,r,o,h,c,p,l,u,m,d,f;for(null==a&&(a=this.character),l=a.mapx,u=a.mapy,r=a.direction,d=i.Graph.frontArea({mapx:l,mapy:u,direction:r+t,distance:e}),f=[],o=0,c=d.length;c>o;o++)for(m=d[o],h=0,p=n.length;p>h;h++)s=n[h],m.mapx===s.mapx&&m.mapy===s.mapy&&f.push(s);return f},e.prototype.searchTargets=function(t,e){return this._searchCharacters(t,e,this.targets)},e.prototype.searchFriends=function(t,e){return this._searchCharacters(t,e,this.friends)},e.prototype.findNearTarget=function(){var t,e,n,a,s,r;for(s={target:null,distance:99},a=this.targets,e=0,n=a.length;n>e;e++)r=a[e],t=i.Graph.distance(this.character,r),t<s.distance&&(s.distance=t,s.target=r);return s},e.prototype.getHexPosition=function(t){var e,i,n,a,s;return null==t&&(t=6),e=this.character,i=t,n=t/2,a=t/2,t%2!==0&&(e.mapx%2===0?(n-=.5,a+=.5):(n+=.5,a-=.5)),function(){var r,o,h,c,p;for(h=[{mapx:e.mapx,mapy:e.mapy-t},{mapx:e.mapx,mapy:e.mapy+t},{mapx:e.mapx-i,mapy:e.mapy-n},{mapx:e.mapx-i,mapy:e.mapy+a},{mapx:e.mapx+i,mapy:e.mapy-n},{mapx:e.mapx+i,mapy:e.mapy+a}],p=[],r=0,o=h.length;o>r;r++)s=h[r],null!=(null!=(c=this.graph.grid[s.mapx])?c[s.mapy]:void 0)&&p.push(s);return p}.call(this)},e.prototype.setFriendsAndTargets=function(){var t,e,i,n;for(this.friends=[],this.targets=[],n=this.characters,e=0,i=n.length;i>e;e++)t=n[e],t.name!==this.character.name&&(this.character.team===t.team?this.friends.push(t):this.targets.push(t))},e.prototype.setNearTarget=function(){var t;t=this.findNearTarget(),this.target=t.target,this.distance=t.distance},e.prototype.checkShotRange=function(){var t,e,n,a;return e=this,n=i.utils.mapxy2screenxy(this.character),n.direction=this.character.direction,a=i.utils.mapxy2screenxy(this.target),t={source:n,target:a,range:this.character.shot.range,callback:function(t,i){return t?e.rotation=i:void 0}},i.utils.checkDirectionRange(t)},e.prototype.checkMovePosition=function(t){var e,i,n,a,s,r;if(null==t)return!1;if(a=null!=(s=this.graph.grid[t.mapx])?s[t.mapy]:void 0,null==a)return!1;if(a.isWall())return!1;for(r=this.characters,i=0,n=r.length;n>i;i++)if(e=r[i],e.mapx===t.mapx&&e.mapy===t.mapy)return!1;return!0},e.prototype.getFrontPosition=function(){var t;return t=this.character.getLastPosition(this.turn),t.direction=this.character.getLastDirection(this.turn),i.Graph.frontPosition(t)},e.prototype.getBackPosition=function(){var t;return t=this.character.getLastPosition(this.turn),t.direction=this.character.getLastDirection(this.turn),i.Graph.backPosition(t)},e.prototype.checkFrontPosition=function(){var t,e;return e=this.getFrontPosition(),this.checkMovePosition(e)?(t=this.graph.grid[e.mapx][e.mapy],this.character.getRemnantAp()<t.weight+1?!1:!0):!1},e.prototype.checkBackPosition=function(){var t,e;return e=this.getBackPosition(),this.checkMovePosition(e)?(t=this.graph.grid[e.mapx][e.mapy],this.character.getRemnantAp()<t.weight+1?!1:!0):!1},e.prototype.setMoveCommand=function(t){var e,n,a,s,r;null==t&&(t={}),r=null!=(n=t.target)?n:this.target,e=null!=(a=t.length)?a:99,s=i.utils.searchRoute(this.graph,this.character,r,this.characters),e<s.length&&(s=s.slice(0,e)),this.character.addMoveCommand(this.turn,s)},e.prototype.setAttackCommand=function(){this.character.setAttackCommand(this.turn)},e.prototype.setShotCommand=function(){var t,e;t=this.character.getLastDirection(this.turn),e=i.system.character.directions[t].rotation,this.character.addShotCommand(this.turn,this.rotation+e)},e.prototype.setMoveBackCommand=function(t){var e,i,n,a,s,r,o;for(null==t&&(t=1),i=n=0,r=t;r>=0?r>=n:n>=r;i=r>=0?++n:--n)this.checkBackPosition()&&(s=this.getBackPosition(),a=this.graph.grid[s.mapx][s.mapy],e=a.weight+1,o={mapx:s.mapx,mapy:s.mapy,cost:e,back:!0,direction:s.direction},this.character.addMoveCommand(this.turn,[o]))},e.prototype.setMoveFrontCommand=function(t){var e,i,n,a,s,r,o;for(null==t&&(t=1),i=n=0,r=t;r>=0?r>=n:n>=r;i=r>=0?++n:--n)this.checkFrontPosition()&&(s=this.getFrontPosition(),a=this.graph.grid[s.mapx][s.mapy],e=a.weight+1,o={mapx:s.mapx,mapy:s.mapy,cost:e,back:!1,direction:s.direction},this.character.addMoveCommand(this.turn,[o]))},e.prototype.setRotateCommand=function(t){var e;e=this.character.getLastDirection(this.turn),this.character.addRotateCommand(this.turn,e,t)},e.prototype.setDirectionCommand=function(e){var i;e>=0&&5>=e&&(i=this.character.getLastDirection(this.turn),this.character.addRotateCommand(this.turn,i,t[i].rotateIndex[e]))},e}()}.call(this),function(){var t,e,i,n;t="undefined"!=typeof window&&null!==window?window:global,e=t.nz=null!=(i=t.nz)?i:{},t=void 0,e.ai=null!=(n=e.ai)?n:{},e.ai.Default=function(){function t(){}return t.prototype.setupBattlePosition=function(t){var e,i,n,a;return i=t.character,n=t.friends,e=t.area,a=n.indexOf(i),e[a]},t.prototype.setupAction=function(t){},t}(),e.system.addAI("Default",new e.ai.Default)}.call(this),function(){var t,e,i,n;t="undefined"!=typeof window&&null!==window?window:global,e=t.nz=null!=(i=t.nz)?i:{},t=void 0,e.ai=null!=(n=e.ai)?n:{},e.ai.Rule=function(){function t(t){this._caller=t,this.rules=[]}return t.prototype.add=function(t){return this.rules.push(t)},t.prototype.setupAction=function(t){var e,i,n,a,s;for(a=this.rules,e=0,i=a.length;i>e&&(n=a[e],!(n.cond.call(this._caller,t)&&(null!=(s=n.setup)?s.call(this._caller,t):void 0)));e++);},t}()}.call(this),function(){tm.main(function(){var t,e,i;return i=nz.system.screen,e=nz.system.assets,nz.system.app=t=tm.display.CanvasApp("#world"),t.resize(i.width,i.height),t.fitWindow(),t.background="gray",t.pushScene(tm.game.LoadingScene({assets:e,width:i.width,height:i.height}).on("load",function(t){this.app.fitWindow(),nz.system.start()})),t.run()})}.call(this);
//# sourceMappingURL=main.min.js.map